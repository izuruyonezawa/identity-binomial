# Dangers of estimating the adjusted risk difference from an identity-link generalised linear model

## Description
We summarise the simulation code used to produce the results presented in the main text and supplement. To avoid redundancy, we provide parameterised or representative code where appropriate, and results from related simulations can be reproduced by varying parameters or datasets. However, we still selectively share code to produce simulation datasets for reproducing key results.

*Terminology notes: A simulated dataset refers to a dataset generated by one of the data-generating mechanisms (DGMs) in one repetition. An estimates dataset refers to a dataset containing results of specified method(s) of analysis for each simulated dataset across many repetitions, which is used to measure performance.*

## Folders
### 01_Preliminary_analysis_Stata_R_SAS
Code for preliminary analysis using simple datasets in Stata, R and SAS to reproduce the results shown in Table 2.

### 02_Stata_main_analysis
#### 01_Data_generating_mechanisms
Code for specifying DGMs for each of the four scenarios with varying parameters, as shown in Table 3.
#### 02_Simulation_examples
Nine selected example simulation scripts to reproduce key findings. These are based on identity-binomial models with IRLS and a single binary covariate in nine selected DGMs. The estimates datasets from these simulations are also stored in `05_Datasets`. The estimates datasets produced by specific combinations of DGMs, the number of covariates and maximisation methods, including these nine datasets, are used to measure the performance of identity-binomial models, as demonstrated in `03_Measuring_performance`. These nine estimates datasets are also used in `04_Exploratory_analysis` and `05_Evaluating_diagnostics`.
#### 03_Measuring_performance
Code for measuring non-convergence rates, rates of implausibly small standard errors, and coverage for converged models, with their confidence intervals, using an example estimates dataset produced by `01_DGMs_scenario_1.do` in `02_Simulation_examples`. Applying these procedures to relevant estimates datasets and plotting the results will produce Figs. 2-4, Figs. S3-S5 and S7. Also, Fig. S6 (four zip plots for converged identity-binomial models) can be reproduced by applying `siman zipplot`, as shown in `03_Coverage_for_converged_models`, to the four relevant estimates datasets.
#### 04_Exploratory_analysis
Code for exploring potential diagnostic criteria across the four scenarios. This section is relevant to Figs. S12-S20. Estimates datasets used can be generated by running the example scripts in `02_Simulation_examples`. These datasets, along with an additional explanatory Excel file used for Fig. S18, are also provided in the `05_Datasets`. 
#### 05_Evaluating_diagnostics
Code showing the performance of proposed and failed diagnostics for identity-binomial models with IRLS. This section is relevant to Fig. 5 and Figs. S21-S28. Applying the procedure to estimate conditional coverage of diagnostic positives and negatives, as shown, for example, in `02_Diagnostic_proposed_scenario_1`, to relevant estimates datasets and plotting the results will produce Fig. 5 and Fig. S28 (line graphs showing the performance of the proposed diagnostic across different DGMs). Estimates datasets used for Figs. S21-S27 can be generated by relevant scripts in `02_Simulation_examples` and are also provided in the `05_Datasets`.

### 03_R_vs_Stata
Code for evaluating identity-binomial models in R, in comparison with the results from Stata. This section is relevant to Figs. S8-S11 and S29. For a proper comparison, we use the same set of simulated datasets produced in Stata, using the DGM with the largest interaction in scenario 4. We also show the performance of the proposed diagnostic applied to the estimates from R in this setting. The same procedures can be applied to the DGM in scenario 2.  

### 04_VIETNARMS
Code for analysis using the VIETNARMS dataset to reproduce the results shown in Table 4.
 
### 05_Datasets
Nine example estimates datasets generated from `02_Simulation_examples`, along with an additional explanatory Excel file used for Fig. S18.
